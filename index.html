<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="POSIEAT">
    <title>æ–°ãƒ¬ã‚¸ã€ŒPOSIEATã€</title>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP" rel="stylesheet" />
    <link rel="stylesheet" href="./css/memo.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- ğŸ“Š ã‚°ãƒ©ãƒ•ã‚’æããŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>

    <!-- ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ç”»é¢ -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-icon"><img src="./img/posieat_app_icon.svg" alt=""></div>
    </div>


    <div class="app-container">
        <div class="header">
            <h1>POSIEAT</h1>
            <p>POS SYSTEM</p>

            <div class="floating-icons">
                <span class="floating-icon" style="--delay: 0s; --x: 15%; --y: 25%;">â—†</span>
                <span class="floating-icon" style="--delay: 2s; --x: 85%; --y: 35%;">â—</span>
                <span class="floating-icon" style="--delay: 4s; --x: 25%; --y: 75%;">â–²</span>
                <span class="floating-icon" style="--delay: 6s; --x: 75%; --y: 65%;">â– </span>
                <span class="floating-icon" style="--delay: 8s; --x: 55%; --y: 85%;">â¬¢</span>
            </div>
        </div>
    
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="showTab('menu')">ğŸ“± æ³¨æ–‡ãƒ»ä¼šè¨ˆ</button>
            <button class="tab-btn" onclick="showTab('history')">ğŸ“Š å£²ä¸Šå±¥æ­´</button>
            <button class="tab-btn" onclick="showTab('deleted')">ğŸ—‘ï¸ å‰Šé™¤å±¥æ­´</button>
            <!-- ğŸ“ˆ æ–°ã—ã„ã‚¿ãƒ–ã‚’è¿½åŠ ï¼šä»Šæ—¥ã®å£²ä¸Šã‚’ã‚°ãƒ©ãƒ•ã§è¦‹ã‚‹ãŸã‚ã®ãƒœã‚¿ãƒ³ -->
            <button class="tab-btn" onclick="showTab('analytics')">ğŸ“ˆ å£²ä¸Šåˆ†æ</button>
        </div>
    
        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»æ³¨æ–‡ç”»é¢ -->
        <div id="menu-tab" class="main-content">
            <div class="menu-section">
                <h2>ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
                <div class="menu-category-tabs" id="category-tabs">
                    <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ–ã¯JavaScriptã§ç”Ÿæˆ -->
                </div>
                <div class="menu-display-area" id="menu-display">
                    <!-- é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º -->
                </div>
            </div>
    
            <div class="cart-section">
                <h2>ğŸ›’ ã”æ³¨æ–‡</h2>
                <div class="cart-items-container" id="cart-items">
                    <div class="empty-message">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸ã‚“ã§ã”æ³¨æ–‡ãã ã•ã„</div>
                </div>
    
                <div class="total-section">
                    <div class="total-amount" id="total-amount">åˆè¨ˆ: Â¥0</div>
                    <div class="action-buttons">
                        <button class="btn btn-clear" onclick="clearCart()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        <button class="btn btn-checkout" onclick="checkout()">ğŸ’³ ä¼šè¨ˆ</button>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- å±¥æ­´ç”»é¢ -->
        <div id="history-tab" class="history-section">
            <div class="history-controls">
                <div class="history-title">ğŸ“ˆ å£²ä¸Šå±¥æ­´</div>
                <button class="btn-delete-all" onclick="confirmDeleteAll()">ğŸ—‘ï¸ å…¨å‰Šé™¤</button>
            </div>
            <div id="history-list">
                <div class="empty-message">ã¾ã å£²ä¸Šå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>
            </div>
        </div>
    
        <!-- ğŸ—‘ï¸ æ–°ã—ã„ç”»é¢ã‚’è¿½åŠ ï¼šå‰Šé™¤ã•ã‚ŒãŸæ³¨æ–‡ã®å±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹ç”»é¢ -->
        <div id="deleted-tab" class="history-section">
            <div class="history-controls">
                <div class="history-title">ğŸ—‘ï¸ å‰Šé™¤å±¥æ­´</div>
                <!-- å‰Šé™¤å±¥æ­´ã‚’å®Œå…¨ã«æ¶ˆå»ã™ã‚‹ãƒœã‚¿ãƒ³ -->
                <button class="btn-delete-all" onclick="confirmClearDeletedHistory()">ğŸ§¹ å±¥æ­´ã‚¯ãƒªã‚¢</button>
            </div>
            <div id="deleted-list">
                <div class="empty-message">å‰Šé™¤ã•ã‚ŒãŸå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>
            </div>
        </div>
    
        <!-- ğŸ“ˆ æ–°ã—ã„ç”»é¢ã‚’è¿½åŠ ï¼šå£²ä¸Šåˆ†æã¨ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã™ã‚‹ç”»é¢ -->
        <div id="analytics-tab" class="history-section">
            <div class="history-controls">
                <div class="history-title">ğŸ“ˆ å£²ä¸Šåˆ†æ</div>
                <!-- æ—¥ä»˜ã‚’é¸æŠã™ã‚‹ãŸã‚ã®ãƒœã‚¿ãƒ³ -->
                <input type="date" id="analytics-date" class="date-picker" onchange="updateAnalytics()" />
            </div>
    
            <!-- ğŸ“Š ä»Šæ—¥ã®å£²ä¸Šã®æ¦‚è¦ã‚’è¡¨ç¤ºã™ã‚‹ã‚«ãƒ¼ãƒ‰ -->
            <div class="analytics-summary">
                <div class="summary-card">
                    <div class="summary-icon">ğŸ’°</div>
                    <div class="summary-content">
                        <div class="summary-title">ç·å£²ä¸Š</div>
                        <div class="summary-value" id="total-sales">Â¥0</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">ğŸ“‹</div>
                    <div class="summary-content">
                        <div class="summary-title">æ³¨æ–‡æ•°</div>
                        <div class="summary-value" id="total-orders">0ä»¶</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">ğŸ¥˜</div>
                    <div class="summary-content">
                        <div class="summary-title">å•†å“æ•°</div>
                        <div class="summary-value" id="total-items">0å€‹</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">ğŸ’µ</div>
                    <div class="summary-content">
                        <div class="summary-title">å¹³å‡æ³¨æ–‡é¡</div>
                        <div class="summary-value" id="average-order">Â¥0</div>
                    </div>
                </div>
            </div>
    
            <!-- ğŸ“Š ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€ -->
            <div class="charts-container">
                <!-- æ™‚é–“åˆ¥å£²ä¸Šã‚°ãƒ©ãƒ• -->
                <div class="chart-section">
                    <h3>â° æ™‚é–“åˆ¥å£²ä¸Š</h3>
                    <canvas id="hourly-chart" width="400" height="200"></canvas>
                </div>
    
                <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šã‚°ãƒ©ãƒ• -->
                <div class="chart-section">
                    <h3>ğŸ½ï¸ ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Š</h3>
                    <canvas id="category-chart" width="400" height="200"></canvas>
                </div>
    
                <!-- äººæ°—å•†å“ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
                <div class="chart-section">
                    <h3>ğŸ† äººæ°—å•†å“ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
                    <div id="popular-items-list">
                        <div class="empty-message">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
    <div id="confirm-dialog" class="confirm-dialog">
        <div class="confirm-content">
            <div class="confirm-title" id="confirm-title">ç¢ºèª</div>
            <div class="confirm-message" id="confirm-message">ã“ã®æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ</div>
            <div class="confirm-buttons">
                <button class="btn-confirm yes" id="confirm-yes">å®Ÿè¡Œ</button>
                <button class="btn-confirm no" onclick="hideConfirmDialog()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>
    
    <script>
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ï¼‰
        const menuCategories = {
            'ğŸ– ãƒ¡ã‚¤ãƒ³æ–™ç†': [
                { name: 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒ¼ã‚¬ãƒ¼', price: 1280, emoji: 'ğŸ”' },
                { name: 'ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼', price: 980, emoji: 'ğŸ§€' },
                { name: 'ãƒãƒ«ã‚²ãƒªãƒ¼ã‚¿ãƒ”ã‚¶', price: 1580, emoji: 'ğŸ•' },
                { name: 'ã‚«ãƒ«ãƒœãƒŠãƒ¼ãƒ©', price: 1180, emoji: 'ğŸ' },
                { name: 'ãƒ•ãƒ©ã‚¤ãƒ‰ãƒã‚­ãƒ³', price: 890, emoji: 'ğŸ—' },
                { name: 'ãƒ“ãƒ¼ãƒ•ã‚¹ãƒ†ãƒ¼ã‚­', price: 2480, emoji: 'ğŸ¥©' }
            ],
            'ğŸ¥— ã‚µã‚¤ãƒ‰': [
                { name: 'ãƒˆãƒªãƒ¥ãƒ•ãƒãƒ†ãƒˆ', price: 680, emoji: 'ğŸŸ' },
                { name: 'ã‚·ãƒ¼ã‚¶ãƒ¼ã‚µãƒ©ãƒ€', price: 780, emoji: 'ğŸ¥—' },
                { name: 'ã‚ªãƒ‹ã‚ªãƒ³ãƒªãƒ³ã‚°', price: 580, emoji: 'ğŸ§…' },
                { name: 'ã‚¬ãƒ¼ãƒªãƒƒã‚¯ãƒ–ãƒ¬ãƒƒãƒ‰', price: 480, emoji: 'ğŸ¥–' }
            ],
            'ğŸ¥¤ ãƒ‰ãƒªãƒ³ã‚¯': [
                { name: 'ã‚¯ãƒ©ãƒ•ãƒˆã‚³ãƒ¼ãƒ©', price: 380, emoji: 'ğŸ¥¤' },
                { name: 'ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚¸ãƒ¥ãƒ¼ã‚¹', price: 480, emoji: 'ğŸ§ƒ' },
                { name: 'ã‚¨ã‚¹ãƒ—ãƒ¬ãƒƒã‚½', price: 450, emoji: 'â˜•' },
                { name: 'ã‚¢ãƒ¼ãƒ«ã‚°ãƒ¬ã‚¤', price: 420, emoji: 'ğŸµ' },
                { name: 'ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼', price: 680, emoji: 'ğŸ¥¤' },
                { name: 'ãƒ¯ã‚¤ãƒ³', price: 980, emoji: 'ğŸ·' }
            ],
            'ğŸ° ãƒ‡ã‚¶ãƒ¼ãƒˆ': [
                { name: 'ãƒ†ã‚£ãƒ©ãƒŸã‚¹', price: 680, emoji: 'ğŸ°' },
                { name: 'ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ', price: 480, emoji: 'ğŸ¦' },
                { name: 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚±ãƒ¼ã‚­', price: 780, emoji: 'ğŸ«' },
                { name: 'ãƒ•ãƒ«ãƒ¼ãƒ„ã‚¿ãƒ«ãƒˆ', price: 880, emoji: 'ğŸ¥§' },
                { name: 'ãƒ—ãƒªãƒ³', price: 580, emoji: 'ğŸ®' }
            ]
        };

        // ã‚«ãƒ¼ãƒˆï¼ˆæ³¨æ–‡å†…å®¹ï¼‰ã¨ãƒ¬ã‚·ãƒ¼ãƒˆå±¥æ­´ã‚’ä¿å­˜
        let cart = {};        
        let activeCategory = 'ğŸ– ãƒ¡ã‚¤ãƒ³æ–™ç†';

        
        
        // ğŸ“Š æ–°ã—ã„å¤‰æ•°ã‚’è¿½åŠ ï¼šã‚°ãƒ©ãƒ•ã‚’æããŸã‚ã®Chart.jsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // ã‚°ãƒ©ãƒ•ã‚’æã„ã¦ã€å¾Œã§æ›´æ–°ã™ã‚‹ã¨ãã«ä½¿ã„ã¾ã™
        let hourlyChart = null; // æ™‚é–“åˆ¥å£²ä¸Šã‚°ãƒ©ãƒ•
        let categoryChart = null; // ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šã‚°ãƒ©ãƒ•

        // æ³¨æ„ï¼šå®Ÿéš›ã®ç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã¦localStorageã‚’ä½¿ç”¨
        let orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
        let orderNumber = parseInt(localStorage.getItem('orderNumber') || '1');
        let deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');

        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®æœ€é©åŒ–
        let touchStartY = 0;
        let touchEndY = 0;

        // ã‚¹ãƒ¯ã‚¤ãƒ—ã§ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰
        function handleTouchStart(e) {
            touchStartY = e.touches[0].clientY;
        }

        function handleTouchEnd(e) {
            touchEndY = e.changedTouches[0].clientY;
            handleSwipe();
        }

        function handleSwipe() {
            const swipeThreshold = 100;
            const diff = touchStartY - touchEndY;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // ä¸Šã‚¹ãƒ¯ã‚¤ãƒ— - å±¥æ­´ç”»é¢ã¸
                    if ($('#menu-tab').is(':visible')) {
                        showTab('history');
                    }
                } else {
                    // ä¸‹ã‚¹ãƒ¯ã‚¤ãƒ— - ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã¸
                    if ($('#history-tab').is(':visible')) {
                        showTab('menu');
                    }
                }
            }
        }

        // ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ã®åˆæœŸåŒ–
        function initMobileOptimizations() {
            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®è¿½åŠ 
            if ('ontouchstart' in window) {
                document.addEventListener('touchstart', handleTouchStart, { passive: true });
                document.addEventListener('touchend', handleTouchEnd, { passive: true });
            }

            // ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆé«˜ã•ã®å‹•çš„èª¿æ•´ï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ã®URLæ¬„å¯¾ç­–ï¼‰
            function setViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }

            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            window.addEventListener('orientationchange', () => {
                setTimeout(setViewportHeight, 100);
            });

            // iOS Safari ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ”¹å–„
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                document.body.style.webkitOverflowScrolling = 'touch';
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–ï¼ˆæ›´æ–°ï¼‰
        $(document).ready(function () {
            createMenuItems();
            loadOrderHistory();
            updateCartDisplay();
            initMobileOptimizations();

            // ğŸ“ˆ å£²ä¸Šåˆ†æã®åˆæœŸåŒ–ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
            initAnalytics();

            // ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰åŠ¹æœ
            $('.app-container').addClass('loaded');
        });

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
        function createMenuItems() {
            createCategoryTabs();
            showCategory(activeCategory);
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ–ã‚’ç”Ÿæˆ
        function createCategoryTabs() {
            let tabsHtml = '';

            for (let category in menuCategories) {
                const isActive = category === activeCategory ? 'active' : '';
                tabsHtml += `
                        <div class="category-tab ${isActive}" onclick="showCategory('${category}')">
                            ${category}
                        </div>
                    `;
            }

            $('#category-tabs').html(tabsHtml);
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
        function showCategory(categoryName) {
            activeCategory = categoryName;

            // ã‚¿ãƒ–ã®çŠ¶æ…‹æ›´æ–°
            $('.category-tab').removeClass('active');
            $(`.category-tab:contains('${categoryName.split(' ')[1]}')`).addClass('active');

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã®æ›´æ–°
            const items = menuCategories[categoryName];
            let contentHtml = `
                    <div class="category-content active">
                        <div class="category-header-display">${categoryName}</div>
                        <div class="menu-category">
                            <div class="menu-items-grid">
                `;

            items.forEach(item => {
                contentHtml += `
                        <div class="menu-item" onclick="addToCart('${item.name}', ${item.price})">
                            <div class="emoji">${item.emoji}</div>
                            <div class="name">${item.name}</div>
                            <div class="price">Â¥${item.price.toLocaleString()}</div>
                        </div>
                    `;
            });

            contentHtml += `
                            </div>
                        </div>
                    </div>
                `;

            $('#menu-display').html(contentHtml);
        }

        // ã‚«ãƒ¼ãƒˆã«å•†å“ã‚’è¿½åŠ 
        function addToCart(name, price) {
            if (cart[name]) {
                cart[name].quantity += 1;
            } else {
                cart[name] = { price: price, quantity: 1 };
            }
            updateCartDisplay();
            showToast(`${name} ã‚’ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ`, 'success');
        }

        // å•†å“æ•°é‡ã®å¤‰æ›´
        function changeQuantity(name, change) {
            if (cart[name]) {
                cart[name].quantity += change;
                if (cart[name].quantity <= 0) {
                    delete cart[name];
                    showToast(`${name} ã‚’ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ`, 'danger');
                }
            }
            updateCartDisplay();
        }

        // ã‚«ãƒ¼ãƒˆè¡¨ç¤ºã®æ›´æ–°
        function updateCartDisplay() {
            const cartItems = $('#cart-items');
            const totalAmount = $('#total-amount');

            if (Object.keys(cart).length === 0) {
                cartItems.html('<div class="empty-message">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸ã‚“ã§ã”æ³¨æ–‡ãã ã•ã„</div>');
                totalAmount.text('åˆè¨ˆ: Â¥0');
                return;
            }

            let html = '';
            let total = 0;

            for (let name in cart) {
                const item = cart[name];
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                html += `
                        <div class="cart-item">
                            <div class="item-info">
                                <div class="name">${name}</div>
                                <div class="price">Â¥${item.price.toLocaleString()} Ã— ${item.quantity} = Â¥${itemTotal.toLocaleString()}</div>
                            </div>
                            <div class="item-controls">
                                <button class="qty-btn" onclick="changeQuantity('${name}', -1)">âˆ’</button>
                                <div class="quantity">${item.quantity}</div>
                                <button class="qty-btn" onclick="changeQuantity('${name}', 1)">ï¼‹</button>
                            </div>
                        </div>
                    `;
            }

            cartItems.html(html);
            totalAmount.text(`åˆè¨ˆ: Â¥${total.toLocaleString()}`);
        }

        // ã‚«ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢
        function clearCart() {
            if (Object.keys(cart).length === 0) {
                showToast('ã‚«ãƒ¼ãƒˆã¯æ—¢ã«ç©ºã§ã™', 'danger');
                return;
            }
            cart = {};
            updateCartDisplay();
            showToast('ã‚«ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
        }

        // ä¼šè¨ˆå‡¦ç†
        function checkout() {
            if (Object.keys(cart).length === 0) {
                showToast('å•†å“ã‚’é¸ã‚“ã§ãã ã•ã„', 'danger');
                return;
            }

            let total = 0;
            let items = [];
            let message = `ğŸ§¾ ãƒ¬ã‚·ãƒ¼ãƒˆ No.${orderNumber}\n`;
            message += `ğŸ“… ${new Date().toLocaleString()}\n`;
            message += 'â”€'.repeat(30) + '\n';

            for (let name in cart) {
                const item = cart[name];
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                items.push({
                    name: name,
                    price: item.price,
                    quantity: item.quantity,
                    total: itemTotal
                });
                message += `${name}\n  Â¥${item.price.toLocaleString()} Ã— ${item.quantity} = Â¥${itemTotal.toLocaleString()}\n`;
            }

            message += 'â”€'.repeat(30) + '\n';
            message += `ğŸ’° åˆè¨ˆ: Â¥${total.toLocaleString()}\n\n`;
            message += 'ğŸ™ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼';

            // å±¥æ­´ã«ä¿å­˜
            const order = {
                orderNumber: orderNumber,
                date: new Date().toLocaleString(),
                items: items,
                total: total
            };

            orderHistory.push(order);

            // æ³¨æ„ï¼šå®Ÿéš›ã®ç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã¦localStorageã«ä¿å­˜
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            localStorage.setItem('orderNumber', (orderNumber + 1).toString());

            alert(message);

            orderNumber++;
            clearCart();
            updateHistoryDisplay();
            showToast(`Â¥${total.toLocaleString()} ã®ä¼šè¨ˆãŒå®Œäº†ã—ã¾ã—ãŸ`, 'success');
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabName) {
            $('.tab-btn').removeClass('active');

            // ğŸ”„ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã®å‡¦ç†ã‚’æ–°ã—ã„ã‚¿ãƒ–ã«å¯¾å¿œ
            // ã©ã®ã‚¿ãƒ–ãŒæŠ¼ã•ã‚ŒãŸã‹ã«ã‚ˆã£ã¦ã€è¡¨ç¤ºã™ã‚‹ç”»é¢ã‚’å¤‰ãˆã‚‹
            if (tabName === 'menu') {
                // æ³¨æ–‡ãƒ»ä¼šè¨ˆç”»é¢ã‚’è¡¨ç¤º
                $(`button:contains('æ³¨æ–‡ãƒ»ä¼šè¨ˆ')`).addClass('active');
                $('#menu-tab').show();
                $('#history-tab').hide();
                $('#deleted-tab').hide(); // å‰Šé™¤å±¥æ­´ç”»é¢ã‚’éš ã™
            } else if (tabName === 'history') {
                // å£²ä¸Šå±¥æ­´ç”»é¢ã‚’è¡¨ç¤º
                $(`button:contains('å£²ä¸Šå±¥æ­´')`).addClass('active');
                $('#menu-tab').hide();
                $('#history-tab').show();
                $('#deleted-tab').hide(); // å‰Šé™¤å±¥æ­´ç”»é¢ã‚’éš ã™
                updateHistoryDisplay();
            } else if (tabName === 'deleted') {
                // ğŸ—‘ï¸ å‰Šé™¤å±¥æ­´ç”»é¢ã‚’è¡¨ç¤ºï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
                $(`button:contains('å‰Šé™¤å±¥æ­´')`).addClass('active');
                $('#menu-tab').hide();
                $('#history-tab').hide();
                $('#deleted-tab').show(); // å‰Šé™¤å±¥æ­´ç”»é¢ã‚’è¡¨ç¤º
                $('#analytics-tab').hide(); // å£²ä¸Šåˆ†æç”»é¢ã‚’éš ã™
                updateDeletedHistoryDisplay(); // å‰Šé™¤å±¥æ­´ã‚’æ›´æ–°è¡¨ç¤º
            } else if (tabName === 'analytics') {
                // ğŸ“ˆ å£²ä¸Šåˆ†æç”»é¢ã‚’è¡¨ç¤ºï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
                $(`button:contains('å£²ä¸Šåˆ†æ')`).addClass('active');
                $('#menu-tab').hide();
                $('#history-tab').hide();
                $('#deleted-tab').hide(); // å‰Šé™¤å±¥æ­´ç”»é¢ã‚’éš ã™
                $('#analytics-tab').show(); // å£²ä¸Šåˆ†æç”»é¢ã‚’è¡¨ç¤º
                updateAnalytics(); // å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°è¡¨ç¤º
            }
        }

        // å±¥æ­´èª­ã¿è¾¼ã¿
        function loadOrderHistory() {
            // æ³¨æ„ï¼šå®Ÿéš›ã®ç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã¦localStorageã‹ã‚‰èª­ã¿è¾¼ã¿
            orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            orderNumber = parseInt(localStorage.getItem('orderNumber') || '1');
            // ğŸ—‘ï¸ å‰Šé™¤å±¥æ­´ã‚‚èª­ã¿è¾¼ã‚€ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
            deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
            updateHistoryDisplay();
            updateDeletedHistoryDisplay(); // å‰Šé™¤å±¥æ­´ã®è¡¨ç¤ºã‚‚æ›´æ–°
        }

        // å±¥æ­´è¡¨ç¤ºã®æ›´æ–°
        function updateHistoryDisplay() {
            const historyList = $('#history-list');

            if (orderHistory.length === 0) {
                historyList.html('<div class="empty-message">ã¾ã å£²ä¸Šå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>');
                return;
            }

            let html = '';

            for (let i = orderHistory.length - 1; i >= 0; i--) {
                const order = orderHistory[i];

                let itemsHtml = '';
                order.items.forEach(item => {
                    itemsHtml += `${item.name} Ã— ${item.quantity} = Â¥${item.total.toLocaleString()}<br>`;
                });

                html += `
                        <div class="history-item">
                            <div class="history-header">
                                <div class="order-info">
                                    <div class="order-number">æ³¨æ–‡ #${order.orderNumber}</div>
                                    <div class="order-date">${order.date}</div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="order-total">Â¥${order.total.toLocaleString()}</div>
                                    <button class="btn-delete-item" onclick="confirmDeleteItem(${i})">å‰Šé™¤</button>
                                </div>
                            </div>
                            <div class="history-items">${itemsHtml}</div>
                        </div>
                    `;
            }

            historyList.html(html);
        }

        // ğŸ—‘ï¸ æ–°ã—ã„é–¢æ•°ï¼šå‰Šé™¤å±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // ã“ã®é–¢æ•°ã¯å‰Šé™¤ã•ã‚ŒãŸæ³¨æ–‡ã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚‚ã®
        function updateDeletedHistoryDisplay() {
            const deletedList = $('#deleted-list'); // å‰Šé™¤å±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€ã‚’å–å¾—

            // ã‚‚ã—å‰Šé™¤ã•ã‚ŒãŸæ³¨æ–‡ãŒä¸€ã¤ã‚‚ãªã‘ã‚Œã°ã€ã€Œã‚ã‚Šã¾ã›ã‚“ã€ã¨è¡¨ç¤º
            if (deletedHistory.length === 0) {
                deletedList.html('<div class="empty-message">å‰Šé™¤ã•ã‚ŒãŸå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>');
                return;
            }

            let html = ''; // HTMLã‚’ä½œã‚‹ãŸã‚ã®ç©ºã£ã½ã®ç®±

            // å‰Šé™¤ã•ã‚ŒãŸæ³¨æ–‡ã‚’æ–°ã—ã„é †ï¼ˆæœ€å¾Œã«å‰Šé™¤ã•ã‚ŒãŸã‚‚ã®ã‹ã‚‰ï¼‰ã«è¡¨ç¤º
            for (let i = deletedHistory.length - 1; i >= 0; i--) {
                const order = deletedHistory[i];

                // æ³¨æ–‡ã®ä¸­èº«ã‚’æ–‡å­—ã§è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«æº–å‚™
                let itemsHtml = '';
                order.items.forEach(item => {
                    itemsHtml += `${item.name} Ã— ${item.quantity} = Â¥${item.total.toLocaleString()}<br>`;
                });

                // å‰Šé™¤ã•ã‚ŒãŸæ³¨æ–‡ã®æƒ…å ±ã‚’HTMLã§ä½œæˆ
                html += `
                        <div class="history-item" style="border-left: 4px solid #fa709a;">
                            <div class="history-header">
                                <div class="order-info">
                                    <div class="order-number">æ³¨æ–‡ #${order.orderNumber}</div>
                                    <div class="order-date">æ³¨æ–‡æ—¥: ${order.date}</div>
                                    <div class="order-date" style="color: #e53e3e;">å‰Šé™¤æ—¥: ${order.deletedAt}</div>
                                    <div class="order-date" style="color: #666;">å‰Šé™¤æ–¹æ³•: ${order.deletedReason}</div>
                                </div>
                                <div class="order-total">Â¥${order.total.toLocaleString()}</div>
                            </div>
                            <div class="history-items">${itemsHtml}</div>
                        </div>
                    `;
            }

            deletedList.html(html); // ä½œã£ãŸHTMLã‚’ç”»é¢ã«è¡¨ç¤º
        }

        // ğŸ—‘ï¸ æ–°ã—ã„é–¢æ•°ï¼šå‰Šé™¤å±¥æ­´ã‚’å®Œå…¨ã«æ¶ˆå»ã™ã‚‹ç¢ºèªï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // å‰Šé™¤å±¥æ­´ã‚’ãã‚Œã„ã«æƒé™¤ã™ã‚‹ã‹ã©ã†ã‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«èã
        function confirmClearDeletedHistory() {
            if (deletedHistory.length === 0) {
                showToast('å‰Šé™¤ã™ã‚‹å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“', 'danger');
                return;
            }

            showConfirmDialog(
                'ğŸ§¹ å‰Šé™¤å±¥æ­´ã‚¯ãƒªã‚¢',
                `ã™ã¹ã¦ã®å‰Šé™¤å±¥æ­´ (${deletedHistory.length}ä»¶) ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚<br><br><strong>âš ï¸ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</strong>`,
                function () { clearDeletedHistory(); }
            );
        }

        // ğŸ—‘ï¸ æ–°ã—ã„é–¢æ•°ï¼šå‰Šé™¤å±¥æ­´ã‚’å®Œå…¨ã«æ¶ˆå»ã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // å‰Šé™¤å±¥æ­´ã‚’ç©ºã£ã½ã«ã™ã‚‹
        function clearDeletedHistory() {
            const count = deletedHistory.length;
            deletedHistory = []; // å‰Šé™¤å±¥æ­´ã‚’ç©ºã£ã½ã«ã™ã‚‹

            // æ³¨æ„ï¼šå®Ÿéš›ã®ç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã¦localStorageã‚’æ›´æ–°
             localStorage.setItem('deletedHistory', JSON.stringify(deletedHistory));

            updateDeletedHistoryDisplay(); // ç”»é¢ã‚’æ›´æ–°
            showToast(`${count}ä»¶ã®å‰Šé™¤å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ`, 'success');
        }

        // ğŸ“ˆ æ–°ã—ã„é–¢æ•°ï¼šå£²ä¸Šåˆ†æã®åˆæœŸåŒ–ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // å£²ä¸Šåˆ†æç”»é¢ã‚’æœ€åˆã«è¨­å®šã™ã‚‹
        function initAnalytics() {
            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ—¥ä»˜é¸æŠæ¬„ã«è¨­å®š
            const today = new Date();
            const todayString = today.getFullYear() + '-' +
                String(today.getMonth() + 1).padStart(2, '0') + '-' +
                String(today.getDate()).padStart(2, '0');
            $('#analytics-date').val(todayString);

            // ã‚°ãƒ©ãƒ•ã‚’æœ€åˆã«ä½œã‚‹
            createCharts();
        }

        // ğŸ“Š æ–°ã—ã„é–¢æ•°ï¼šã‚°ãƒ©ãƒ•ã‚’ä½œæˆã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // Chart.jsã‚’ä½¿ã£ã¦ãã‚Œã„ãªã‚°ãƒ©ãƒ•ã‚’ä½œã‚‹
        function createCharts() {
            // æ™‚é–“åˆ¥å£²ä¸Šã‚°ãƒ©ãƒ•ã‚’ä½œã‚‹
            const hourlyCtx = document.getElementById('hourly-chart').getContext('2d');
            hourlyChart = new Chart(hourlyCtx, {
                type: 'line', // ç·šã‚°ãƒ©ãƒ•
                data: {
                    labels: [], // æ™‚é–“ã®ãƒ©ãƒ™ãƒ«ï¼ˆ0æ™‚ã€1æ™‚ã€2æ™‚...ï¼‰
                    datasets: [{
                        label: 'å£²ä¸Šé‡‘é¡',
                        data: [], // å£²ä¸Šãƒ‡ãƒ¼ã‚¿
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4 // ç·šã‚’æ»‘ã‚‰ã‹ã«ã™ã‚‹
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return 'Â¥' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šã‚°ãƒ©ãƒ•ã‚’ä½œã‚‹ï¼ˆå††ã‚°ãƒ©ãƒ•ï¼‰
            const categoryCtx = document.getElementById('category-chart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut', // ãƒ‰ãƒ¼ãƒŠãƒ„å‹å††ã‚°ãƒ©ãƒ•
                data: {
                    labels: [], // ã‚«ãƒ†ã‚´ãƒªå
                    datasets: [{
                        data: [], // å£²ä¸Šãƒ‡ãƒ¼ã‚¿
                        backgroundColor: [
                            '#667eea',
                            '#f093fb',
                            '#4facfe',
                            '#fee140'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ğŸ“ˆ æ–°ã—ã„é–¢æ•°ï¼šå£²ä¸Šåˆ†æã‚’æ›´æ–°ã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // é¸æŠã—ãŸæ—¥ä»˜ã®å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—ã—ã¦ã‚°ãƒ©ãƒ•ã«è¡¨ç¤ºã™ã‚‹
        function updateAnalytics() {
            const selectedDate = $('#analytics-date').val();
            if (!selectedDate) return;

            // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã®æ³¨æ–‡ã ã‘ã‚’å–ã‚Šå‡ºã™
            const selectedOrders = orderHistory.filter(order => {
                const orderDate = new Date(order.date).toISOString().split('T')[0];
                return orderDate === selectedDate;
            });

            // ğŸ“Š å£²ä¸Šæ¦‚è¦ã‚’è¨ˆç®—ã™ã‚‹
            calculateSummary(selectedOrders);

            // ğŸ“ˆ æ™‚é–“åˆ¥å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—ã™ã‚‹
            updateHourlyChart(selectedOrders);

            // ğŸ½ï¸ ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—ã™ã‚‹
            updateCategoryChart(selectedOrders);

            // ğŸ† äººæ°—å•†å“ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¨ˆç®—ã™ã‚‹
            updatePopularItems(selectedOrders);
        }

        // ğŸ’° æ–°ã—ã„é–¢æ•°ï¼šå£²ä¸Šæ¦‚è¦ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // ç·å£²ä¸Šã€æ³¨æ–‡æ•°ã€å•†å“æ•°ã€å¹³å‡æ³¨æ–‡é¡ã‚’è¨ˆç®—ã™ã‚‹
        function calculateSummary(orders) {
            let totalSales = 0; // ç·å£²ä¸Š
            let totalOrders = orders.length; // æ³¨æ–‡æ•°
            let totalItems = 0; // å•†å“æ•°

            // å…¨ã¦ã®æ³¨æ–‡ã‚’è¦‹ã¦ã€å£²ä¸Šã¨å•†å“æ•°ã‚’è¶³ã—ã¦ã„ã
            orders.forEach(order => {
                totalSales += order.total; // å£²ä¸Šã‚’è¶³ã™
                order.items.forEach(item => {
                    totalItems += item.quantity; // å•†å“æ•°ã‚’è¶³ã™
                });
            });

            // å¹³å‡æ³¨æ–‡é¡ã‚’è¨ˆç®—ï¼ˆæ³¨æ–‡æ•°ãŒ0ã®å ´åˆã¯0ã«ã™ã‚‹ï¼‰
            const averageOrder = totalOrders > 0 ? totalSales / totalOrders : 0;

            // ç”»é¢ã«è¡¨ç¤ºã™ã‚‹
            $('#total-sales').text('Â¥' + totalSales.toLocaleString());
            $('#total-orders').text(totalOrders + 'ä»¶');
            $('#total-items').text(totalItems + 'å€‹');
            $('#average-order').text('Â¥' + Math.round(averageOrder).toLocaleString());
        }

        // â° æ–°ã—ã„é–¢æ•°ï¼šæ™‚é–“åˆ¥å£²ä¸Šã‚°ãƒ©ãƒ•ã‚’æ›´æ–°ã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // 0æ™‚ã‹ã‚‰23æ™‚ã¾ã§ã€å„æ™‚é–“ã®å£²ä¸Šã‚’è¨ˆç®—ã—ã¦ã‚°ãƒ©ãƒ•ã«è¡¨ç¤ºã™ã‚‹
        function updateHourlyChart(orders) {
            // 0æ™‚ã‹ã‚‰23æ™‚ã¾ã§ã€24æ™‚é–“åˆ†ã®å£²ä¸Šã‚’å…¥ã‚Œã‚‹ç®±ã‚’ç”¨æ„
            const hourlyData = new Array(24).fill(0);

            // å…¨ã¦ã®æ³¨æ–‡ã‚’è¦‹ã¦ã€ä½•æ™‚ã«æ³¨æ–‡ã•ã‚ŒãŸã‹ã‚’èª¿ã¹ã‚‹
            orders.forEach(order => {
                const hour = new Date(order.date).getHours(); // æ³¨æ–‡æ™‚åˆ»ã‚’å–å¾—
                hourlyData[hour] += order.total; // ãã®æ™‚é–“ã®å£²ä¸Šã«è¿½åŠ 
            });

            // æ™‚é–“ã®ãƒ©ãƒ™ãƒ«ã‚’ä½œã‚‹ï¼ˆ0æ™‚ã€1æ™‚ã€2æ™‚...23æ™‚ï¼‰
            const labels = Array.from({ length: 24 }, (_, i) => i + 'æ™‚');

            // ã‚°ãƒ©ãƒ•ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            hourlyChart.data.labels = labels;
            hourlyChart.data.datasets[0].data = hourlyData;
            hourlyChart.update(); // ã‚°ãƒ©ãƒ•ã‚’å†æç”»
        }

        // ğŸ½ï¸ æ–°ã—ã„é–¢æ•°ï¼šã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šã‚°ãƒ©ãƒ•ã‚’æ›´æ–°ã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // ãƒ¡ã‚¤ãƒ³æ–™ç†ã€ã‚µã‚¤ãƒ‰ã€ãƒ‰ãƒªãƒ³ã‚¯ã€ãƒ‡ã‚¶ãƒ¼ãƒˆã®å£²ä¸Šã‚’è¨ˆç®—ã™ã‚‹
        function updateCategoryChart(orders) {
            const categoryData = {}; // ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šã‚’å…¥ã‚Œã‚‹ç®±

            // å…¨ã¦ã®æ³¨æ–‡ã®å•†å“ã‚’è¦‹ã¦ã€ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«å£²ä¸Šã‚’è¨ˆç®—
            orders.forEach(order => {
                order.items.forEach(item => {
                    // å•†å“åã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªã‚’è¦‹ã¤ã‘ã‚‹
                    let category = 'ä¸æ˜';
                    for (let cat in menuCategories) {
                        const found = menuCategories[cat].find(menuItem => menuItem.name === item.name);
                        if (found) {
                            category = cat;
                            break;
                        }
                    }

                    // ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šã«è¿½åŠ 
                    if (!categoryData[category]) {
                        categoryData[category] = 0;
                    }
                    categoryData[category] += item.total;
                });
            });

            // ã‚°ãƒ©ãƒ•ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            const labels = Object.keys(categoryData);
            const data = Object.values(categoryData);

            categoryChart.data.labels = labels;
            categoryChart.data.datasets[0].data = data;
            categoryChart.update(); // ã‚°ãƒ©ãƒ•ã‚’å†æç”»
        }

        // ğŸ† æ–°ã—ã„é–¢æ•°ï¼šäººæ°—å•†å“ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°ã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
        // ã©ã®å•†å“ãŒãŸãã•ã‚“å£²ã‚ŒãŸã‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ä½œã‚‹
        function updatePopularItems(orders) {
            const itemData = {}; // å•†å“åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹ç®±

            // å…¨ã¦ã®æ³¨æ–‡ã®å•†å“ã‚’è¦‹ã¦ã€å•†å“åˆ¥ã«å£²ä¸Šã¨æ•°é‡ã‚’è¨ˆç®—
            orders.forEach(order => {
                order.items.forEach(item => {
                    if (!itemData[item.name]) {
                        itemData[item.name] = {
                            quantity: 0, // å£²ã‚ŒãŸå€‹æ•°
                            sales: 0     // å£²ä¸Šé‡‘é¡
                        };
                    }
                    itemData[item.name].quantity += item.quantity;
                    itemData[item.name].sales += item.total;
                });
            });

            // å£²ä¸Šé‡‘é¡é †ã«ã‚½ãƒ¼ãƒˆï¼ˆä¸¦ã³æ›¿ãˆï¼‰
            const sortedItems = Object.entries(itemData)
                .sort((a, b) => b[1].sales - a[1].sales)
                .slice(0, 10); // ä¸Šä½10ä½ã¾ã§

            // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ç”»é¢ã«è¡¨ç¤º
            let html = '';
            if (sortedItems.length === 0) {
                html = '<div class="empty-message">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            } else {
                sortedItems.forEach(([name, data], index) => {
                    html += `
                            <div class="popular-item">
                                <div class="popular-item-rank">${index + 1}</div>
                                <div class="popular-item-info">
                                    <div class="popular-item-name">${name}</div>
                                    <div class="popular-item-count">${data.quantity}å€‹å£²ä¸Š</div>
                                </div>
                                <div class="popular-item-sales">Â¥${data.sales.toLocaleString()}</div>
                            </div>
                        `;
                });
            }

            $('#popular-items-list').html(html);
        }

        // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
        function showConfirmDialog(title, message, onConfirm) {
            $('#confirm-title').text(title);
            $('#confirm-message').html(message);
            $('#confirm-yes').off('click').on('click', function () {
                onConfirm();
                hideConfirmDialog();
            });
            $('#confirm-dialog').show();
        }

        // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°éè¡¨ç¤º
        function hideConfirmDialog() {
            $('#confirm-dialog').hide();
        }

        // å€‹åˆ¥å±¥æ­´å‰Šé™¤ã®ç¢ºèª
        function confirmDeleteItem(index) {
            const order = orderHistory[orderHistory.length - 1 - index];
            showConfirmDialog(
                'ğŸ“‹ å±¥æ­´å‰Šé™¤',
                `æ³¨æ–‡ #${order.orderNumber} (Â¥${order.total.toLocaleString()})<br><br>ã“ã®æ³¨æ–‡å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`,
                function () { deleteHistoryItem(index); }
            );
        }

        // å…¨å±¥æ­´å‰Šé™¤ã®ç¢ºèª
        function confirmDeleteAll() {
            if (orderHistory.length === 0) {
                showToast('å‰Šé™¤ã™ã‚‹å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“', 'danger');
                return;
            }

            showConfirmDialog(
                'ğŸ—‘ï¸ å…¨å±¥æ­´å‰Šé™¤',
                `ã™ã¹ã¦ã®å£²ä¸Šå±¥æ­´ (${orderHistory.length}ä»¶) ã‚’å‰Šé™¤ã—ã¾ã™ã€‚<br><br><strong>âš ï¸ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</strong>`,
                function () { deleteAllHistory(); }
            );
        }

        // å€‹åˆ¥å±¥æ­´å‰Šé™¤
        function deleteHistoryItem(index) {
            const realIndex = orderHistory.length - 1 - index;
            const deletedOrder = orderHistory[realIndex];

            // ğŸ—‘ï¸ å‰Šé™¤ã™ã‚‹å‰ã«ã€å‰Šé™¤å±¥æ­´ã«ä¿å­˜ã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
            // å‰Šé™¤ã•ã‚Œã‚‹æ³¨æ–‡ã«ã€Œã„ã¤å‰Šé™¤ã•ã‚ŒãŸã‹ã€ã®æƒ…å ±ã‚’è¿½åŠ 
            const deletedOrderWithTimestamp = {
                ...deletedOrder, // å…ƒã®æ³¨æ–‡æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼
                deletedAt: new Date().toLocaleString(), // å‰Šé™¤ã•ã‚ŒãŸæ—¥æ™‚ã‚’è¨˜éŒ²
                deletedReason: 'å€‹åˆ¥å‰Šé™¤' // ã©ã†ã‚„ã£ã¦å‰Šé™¤ã•ã‚ŒãŸã‹ã‚’è¨˜éŒ²
            };
            deletedHistory.push(deletedOrderWithTimestamp); // å‰Šé™¤å±¥æ­´ã«è¿½åŠ 

            // å…ƒã®å±¥æ­´ã‹ã‚‰å‰Šé™¤
            orderHistory.splice(realIndex, 1);

            // æ³¨æ„ï¼šå®Ÿéš›ã®ç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã¦localStorageã‚’æ›´æ–°
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            localStorage.setItem('deletedHistory', JSON.stringify(deletedHistory));

            updateHistoryDisplay();
            updateDeletedHistoryDisplay(); // å‰Šé™¤å±¥æ­´ã®è¡¨ç¤ºã‚‚æ›´æ–°
            showToast(`æ³¨æ–‡ #${deletedOrder.orderNumber} ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, 'danger');
        }

        // å…¨å±¥æ­´å‰Šé™¤
        function deleteAllHistory() {
            const count = orderHistory.length;

            // ğŸ—‘ï¸ å…¨éƒ¨ã®æ³¨æ–‡ã‚’å‰Šé™¤å±¥æ­´ã«ç§»å‹•ã™ã‚‹ï¼ˆæ–°ã—ãè¿½åŠ ï¼‰
            // ä¸€ã¤ãšã¤å‰Šé™¤å±¥æ­´ã«è¿½åŠ ã—ã¦ã„ã
            orderHistory.forEach(order => {
                const deletedOrderWithTimestamp = {
                    ...order, // å…ƒã®æ³¨æ–‡æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼
                    deletedAt: new Date().toLocaleString(), // å‰Šé™¤ã•ã‚ŒãŸæ—¥æ™‚ã‚’è¨˜éŒ²
                    deletedReason: 'å…¨å‰Šé™¤' // å…¨å‰Šé™¤ã§æ¶ˆã•ã‚ŒãŸã“ã¨ã‚’è¨˜éŒ²
                };
                deletedHistory.push(deletedOrderWithTimestamp); // å‰Šé™¤å±¥æ­´ã«è¿½åŠ 
            });

            // å£²ä¸Šå±¥æ­´ã‚’ç©ºã£ã½ã«ã™ã‚‹
            orderHistory = [];

            // æ³¨æ„ï¼šå®Ÿéš›ã®ç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã¦localStorageã‚’æ›´æ–°
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            localStorage.setItem('deletedHistory', JSON.stringify(deletedHistory));

            updateHistoryDisplay();
            updateDeletedHistoryDisplay(); // å‰Šé™¤å±¥æ­´ã®è¡¨ç¤ºã‚‚æ›´æ–°
            showToast(`${count}ä»¶ã®å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã—ãŸ`, 'danger');
        }

        // ãƒˆãƒ¼ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showToast(message, type = 'success') {
            const toast = $(`
                    <div class="toast-message toast-${type}">
                        ${message}
                    </div>
                `);

            $('body').append(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        $(document).on('click', '#confirm-dialog', function (e) {
            if (e.target === this) {
                hideConfirmDialog();
            }
        });

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        $(document).keydown(function (e) {
            if (e.key === 'Escape') {
                hideConfirmDialog();
            }
        });
    </script>
</body>
</html>